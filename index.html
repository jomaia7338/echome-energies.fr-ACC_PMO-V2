<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="format-detection" content="telephone=no" />
  <title>Echome √ânergies ‚Äî ACC/PMO Terrain (V3 Mobile)</title>

  <!-- Leaflet -->
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin="anonymous">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
          crossorigin="anonymous"></script>

  <link rel="stylesheet" href="./styles.css">
  <meta name="theme-color" content="#37C3AF">
  <link rel="icon" href="data:,">
</head>
<body>
  <header>
    <h1>Echome √ânergies ¬∑ Outil ACC/PMO ‚Äî Terrain</h1>
    <div id="status" class="muted">Pr√™t</div>
  </header>

  <main class="layout">
    <!-- PANNEAU OPTIONS (bottom sheet mobile) -->
    <aside id="side" class="panel side-scroll">
      <div class="sheet-grabber" aria-hidden="true"></div>
      <div id="error-box" class="hidden"></div>

      <!-- KPIs -->
      <div class="kpis kpis-4">
        <div class="kpi"><span class="lbl">Participants</span><b id="kpiPart">0</b></div>
        <div class="kpi"><span class="lbl">Pire paire</span><b id="kpiWorst">‚Äî</b></div>
        <div class="kpi"><span class="lbl">Conformit√©</span><b id="kpiLegal">‚Äî</b></div>
        <div class="kpi"><span class="lbl">Prospects</span><b id="kpiCand">0</b></div>
      </div>

      <!-- Onglets -->
      <div class="seg tabs">
        <button class="seg-btn active" data-tab="tab-terrain">Terrain</button>
        <button class="seg-btn" data-tab="tab-prosp">Prospection</button>
        <button class="seg-btn" data-tab="tab-part">Participants</button>
        <button class="seg-btn" data-tab="tab-projet">Projet</button>
      </div>

      <!-- TAB : TERRAIN -->
      <section id="tab-terrain" class="tab active">
        <fieldset class="fs">
          <legend>Producteur</legend>

          <div class="row">
            <div>
              <label>Adresse (BAN)</label>
              <input id="addr" type="text" autocomplete="street-address" placeholder="10 rue de la R√©publique, 38000 Grenoble">
            </div>
            <div class="align-end">
              <button id="btnGeocode">G√©ocoder</button>
            </div>
          </div>

          <div class="row">
            <div>
              <label>Adresse postale compl√®te (BAN)</label>
              <input id="addrFull" type="text" placeholder="‚Äî" readonly>
            </div>
            <div class="align-end">
              <span class="muted small">Astuce : <b>ALT-clic</b> (desktop) ou <b>pression longue</b> (mobile) pour fixer le producteur</span>
            </div>
          </div>

          <div class="row">
            <div>
              <label>Latitude</label>
              <input id="prodLat" type="number" inputmode="decimal" autocomplete="off" step="0.000001" placeholder="45.191000">
            </div>
            <div>
              <label>Longitude</label>
              <input id="prodLon" type="number" inputmode="decimal" autocomplete="off" step="0.000001" placeholder="5.684000">
            </div>
          </div>

          <div class="row">
            <div class="align-end">
              <button id="btnSetProducerFromInputs" class="primary">D√©finir (coord.)</button>
              <button id="btnLocate" class="ghost">üìç Me localiser</button>
            </div>
            <div class="align-end">
              <button id="btnClearProducer" class="danger">Supprimer</button>
            </div>
          </div>
        </fieldset>

        <fieldset class="fs">
          <legend>Diam√®tre l√©gal ACC</legend>
          <div class="seg seg-compact" id="zoneBtns">
            <button class="seg-btn active" data-d="2">2 km</button>
            <button class="seg-btn" data-d="10">10 km</button>
            <button class="seg-btn" data-d="20">20 km</button>
            <button class="seg-btn" id="dPersoBtn">Perso‚Ä¶</button>
          </div>
          <div class="row">
            <div>
              <label>Valeur perso (km)</label>
              <input id="distMaxPerso" type="number" min="0.5" step="0.5" placeholder="Ex. 5">
            </div>
            <div class="align-end">
              <label class="toggle"><input id="toggleClickAdd" type="checkbox" checked> Clic = ajouter consommateur</label>
            </div>
          </div>
        </fieldset>

        <fieldset class="fs">
          <legend>Affichages (visuels, non juridiques) ‚Äî OFF par d√©faut</legend>
          <div class="row">
            <label class="toggle"><input type="checkbox" id="toggleMEC"> Afficher le cercle outil (MEC)</label>
            <label class="toggle"><input type="checkbox" id="toggleFeasible"> Afficher la zone faisable (‚à© disques D/2)</label>
          </div>
        </fieldset>
      </section>

      <!-- TAB : PROSPECTION -->
      <section id="tab-prosp" class="tab">
        <fieldset class="fs">
          <legend>Cat√©gories OSM</legend>
          <div class="tags">
            <label><input type="checkbox" class="cat" value="education" checked> √âducation</label>
            <label><input type="checkbox" class="cat" value="sante" checked> Sant√©</label>
            <label><input type="checkbox" class="cat" value="adm" checked> Administrations</label>
            <label><input type="checkbox" class="cat" value="sport"> Sport</label>
            <label><input type="checkbox" class="cat" value="commerce"> Commerce</label>
            <label><input type="checkbox" class="cat" value="industrie"> Industrie</label>
            <label><input type="checkbox" class="cat" value="parking"> Parkings</label>
          </div>
          <div class="row">
            <button id="btnScan" class="primary">Scanner (rayon = D autour du producteur)</button>
            <div class="muted small">Pr√©-filtre D ‚Üí post-filtre admissibilit√© pair-√†-pair.</div>
          </div>
        </fieldset>
      </section>

      <!-- TAB : PARTICIPANTS -->
      <section id="tab-part" class="tab">
        <fieldset class="fs">
          <legend>Ajouter un participant</legend>
          <div class="row">
            <div>
              <label>Nom</label>
              <input id="partNom" type="text" placeholder="Coll√®ge Jean Moulin">
            </div>
            <div>
              <label>Lat / Lon</label>
              <div class="row">
                <input id="partLat" type="number" inputmode="decimal" autocomplete="off" step="0.000001" placeholder="lat">
                <input id="partLon" type="number" inputmode="decimal" autocomplete="off" step="0.000001" placeholder="lon">
              </div>
            </div>
          </div>
          <div class="row">
            <div>
              <label>Type</label>
              <select id="partType">
                <option value="consumer">Consommateur</option>
                <option value="producer">Producteur</option>
              </select>
            </div>
            <div class="align-end">
              <button id="btnAddPart" class="primary">Ajouter</button>
            </div>
          </div>
        </fieldset>

        <fieldset class="fs">
          <legend>Import / Export</legend>
          <div class="row">
            <div>
              <label>Importer CSV ; Nom;Lat;Lon;consumer|producer</label>
              <input id="fileCsv" type="file" accept=".csv,text/csv">
            </div>
            <div class="align-end">
              <button id="btnImportCsv">Importer</button>
              <button id="btnExportCsv" class="ghost">Exporter</button>
            </div>
          </div>
        </fieldset>

        <div id="listParts" class="list"></div>
      </section>

      <!-- TAB : PROJET -->
      <section id="tab-projet" class="tab">
        <fieldset class="fs">
          <legend>Dossier</legend>
          <div class="row">
            <div>
              <label>Nom du dossier</label>
              <input id="projectName" type="text" placeholder="Centrale ‚Äî ACC Is√®re Nord">
            </div>
            <div class="align-end">
              <button id="btnCopyLink" class="ghost">Copier lien dossier</button>
            </div>
          </div>
        </fieldset>

        <div class="row">
          <button id="btnSaveLocal" class="primary">Enregistrer (local)</button>
          <div class="align-end">
            <button id="btnLoadLocal">Charger</button>
            <button id="btnDeleteLocal" class="danger">Supprimer</button>
          </div>
        </div>
      </section>
    </aside>

    <!-- CARTE -->
    <section class="panel map-wrap">
      <div class="map-sticky">
        <div id="map"></div>
        <div class="fab" id="fabOptions" aria-label="Options">‚ò∞</div>

        <!-- BARRE D‚ÄôACTIONS MOBILE -->
        <div class="mobile-toolbar" id="mobileToolbar">
          <button id="mtLocate" title="Me localiser">üìç</button>
          <button id="mtScan" title="Scanner prospects">üîé</button>
          <div class="mt-chipset">
            <button class="chip" data-d="2">2</button>
            <button class="chip" data-d="10">10</button>
            <button class="chip" data-d="20">20</button>
          </div>
          <button id="mtOptions" title="Options">‚ò∞</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Fiche prospect -->
  <aside id="prospectPanel" class="sidecard">
    <header>
      <div>
        <h3 id="pp-title">Prospect</h3>
        <div id="pp-sub" class="muted small">‚Äî</div>
      </div>
      <button id="pp-close" class="ghost">‚úï</button>
    </header>
    <section id="pp-body"></section>
    <footer class="actions">
      <button id="pp-add" class="primary">Ajouter au projet</button>
      <button id="pp-sim">Simuler</button>
      <button id="pp-route" class="ghost">Itin√©raire</button>
    </footer>
  </aside>

  <script src="./app.js"></script>
</body>
</html>
