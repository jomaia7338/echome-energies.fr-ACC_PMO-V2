<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Echome Énergies — Outil terrain ACC/PMO</title>

  <!-- Leaflet -->
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin="anonymous">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
          crossorigin="anonymous"></script>

  <link rel="stylesheet" href="./styles.css">
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#37C3AF">
  <link rel="icon" href="./icons/icon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="./icons/icon-192.png">
</head>
<body>
  <header>
    <h1>Echome Énergies · ACC/PMO — Outil terrain</h1>
    <div id="status" class="muted">Initialisation…</div>
  </header>

  <main>
    <section class="panel">
      <div id="error-box" class="hidden"></div>

      <div class="kpis">
        <div class="kpi"><span class="lbl">Candidats détectés</span><b id="kpiCand">0</b></div>
        <div class="kpi"><span class="lbl">Participants</span><b id="kpiPart">0</b></div>
        <div class="kpi"><span class="lbl">Dans le rayon</span><b id="kpiRayon">0</b></div>
      </div>

      <div class="legend">
        <span class="chip"><span class="dot prod"></span> Centrale</span>
        <span class="chip"><span class="dot cons"></span> Participant</span>
        <span class="chip"><span class="dot cand"></span> Candidat (Overpass)</span>
        <span class="pill" id="communePill">Commune: —</span>
      </div>

      <!-- Identité dossier -->
      <fieldset class="fs">
        <legend>Dossier</legend>
        <div class="row">
          <div>
            <label>Nom du dossier</label>
            <input id="projectName" type="text" placeholder="Ex. Centrale - Zone Isère Nord">
          </div>
          <div class="align-end">
            <button id="btnCopyLink" class="ghost">Copier le lien du dossier</button>
          </div>
        </div>
      </fieldset>

      <!-- Localisation -->
      <fieldset class="fs">
        <legend>Localisation centrale</legend>
        <div class="row">
          <div>
            <label>Adresse (géocodage)</label>
            <input id="addr" type="text" placeholder="Ex. 10 rue de la République, 38000 Grenoble">
          </div>
          <div class="align-end">
            <button id="btnGeocode">Géocoder</button>
          </div>
        </div>

        <div class="row">
          <div>
            <label>Latitude centrale</label>
            <input id="lat" type="number" step="0.000001" placeholder="45.191000">
          </div>
          <div>
            <label>Longitude centrale</label>
            <input id="lon" type="number" step="0.000001" placeholder="5.684000">
          </div>
        </div>

        <div class="row">
          <div>
            <label>Rayon ACC</label>
            <select id="rayonPreset">
              <option value="2">2 km (standard)</option>
              <option value="10">10 km (rural)</option>
              <option value="20">20 km (rural étendu)</option>
              <option value="perso">Perso…</option>
            </select>
          </div>
          <div>
            <label>Rayon perso (km)</label>
            <input id="rayonPerso" type="number" min="0.1" step="0.1" placeholder="Ex. 7.5">
          </div>
        </div>

        <div class="row">
          <div>
            <label>Réseau</label>
            <select id="reseau">
              <option value="BT" selected>BT</option>
              <option value="HTA">HTA</option>
            </select>
          </div>
          <div class="align-end">
            <button id="btnRecentrer">Recentrer carte</button>
            <button id="btnChargerSIS" class="ghost">Charger POI SIS</button>
          </div>
        </div>
      </fieldset>

      <!-- Candidats PMO -->
      <fieldset class="fs">
        <legend>Recherche de consommateurs (Overpass)</legend>
        <div class="tags">
          <label><input type="checkbox" class="cat" value="education" checked> Éducation</label>
          <label><input type="checkbox" class="cat" value="sante" checked> Santé</label>
          <label><input type="checkbox" class="cat" value="adm" checked> Administrations</label>
          <label><input type="checkbox" class="cat" value="sport"> Sport</label>
          <label><input type="checkbox" class="cat" value="commerce"> Commerce</label>
          <label><input type="checkbox" class="cat" value="industrie"> Industrie légère</label>
          <label><input type="checkbox" class="cat" value="parking"> Parkings (ombrière)</label>
        </div>
        <div class="row">
          <button id="btnScan">Scanner le rayon</button>
          <span class="muted small">Le scan interroge OSM dans le rayon sélectionné.</span>
        </div>
      </fieldset>

      <!-- Participants -->
      <fieldset class="fs">
        <legend>Participants PMO</legend>
        <div class="row">
          <div>
            <label>Nom</label>
            <input id="partNom" type="text" placeholder="Ex. Collège Jean Moulin">
          </div>
          <div>
            <label>Lat / Lon</label>
            <div class="row">
              <input id="partLat" type="number" step="0.000001" placeholder="lat">
              <input id="partLon" type="number" step="0.000001" placeholder="lon">
            </div>
          </div>
        </div>
        <div class="row">
          <div>
            <label>Type</label>
            <select id="partType">
              <option value="consumer">Consommateur</option>
              <option value="producer">Producteur</option>
            </select>
          </div>
          <div class="align-end">
            <button id="btnAddPart" class="primary">Ajouter participant</button>
          </div>
        </div>

        <div class="row">
          <div>
            <label>Importer participants (CSV ; Nom;Lat;Lon;consumer|producer)</label>
            <input id="fileCsv" type="file" accept=".csv,text/csv">
          </div>
          <div class="align-end">
            <button id="btnImportCsv">Importer</button>
            <button id="btnExportCsv" class="ghost">Exporter</button>
          </div>
        </div>

        <div id="listParts" class="list"></div>
      </fieldset>

      <div class="row">
        <button id="btnSaveLocal" class="primary">Enregistrer projet (local)</button>
        <div class="align-end">
          <button id="btnLoadLocal">Charger</button>
          <button id="btnDeleteLocal" class="danger">Supprimer</button>
        </div>
      </div>
    </section>

    <section class="panel">
      <div id="map"></div>
    </section>
  </main>

  <script src="./app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(() => {});
      });
    }
  </script>
</body>
</html>
